(()=>{"use strict";function t(t,e,n,r){var o=document.getElementById("card-template").content.cloneNode(!0),c=o.querySelector(".card__like-button"),u=o.querySelector(".card__delete-button"),a=o.querySelector(".card__image"),i=o.querySelector(".card__title"),l=o.querySelector(".like-container");return a.src=t.link,a.alt=t.name,i.textContent=t.name,l.textContent=t.likes.length,t.likes.some((function(t){return t._id===e}))&&c.classList.add("card__like-button_is-active"),t.owner._id!==e&&u.remove(),a.addEventListener("click",n),u&&u.addEventListener("click",(function(e){e.preventDefault(),r(t._id)})),c.addEventListener("click",(function(e){!function(t,e,n,r){(function(t,e){var n=e?"PUT":"DELETE";return fetch("https://nomoreparties.co/v1/".concat("wff-cohort-14","/cards/likes/").concat(t),{method:n,headers:{authorization:"6f573362-5f06-4f70-8bea-df09e2f16ca1"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))})(e,!r.classList.contains("card__like-button_is-active")).then((function(t){n.textContent=t.likes.length,r.classList.toggle("card__like-button_is-active")})).catch((function(t){return console.error("Error:",t)}))}(0,t._id,l,c)})),o}function e(t){t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")}),1),document.addEventListener("keydown",r)}function n(t){t.removeAttribute("style"),setTimeout((function(){t.classList.remove("popup_is-opened")}),1),document.removeEventListener("keydown",r)}function r(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&n(e)}}var o=function(t,e,n,r){var o=t.querySelector(".".concat(e.name,"-error"));o&&(e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass))},c=function(t,e,n){var r=t.querySelector(".".concat(e.name,"-error"));r&&(e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent="")},u=function(t,e,n){a(t)?(e.classList.add(n.inactiveButtonClass),e.disabled=!0):(e.classList.remove(n.inactiveButtonClass),e.disabled=!1)},a=function(t){return t.some((function(t){return!t.validity.valid}))},i=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){c(t,n,e)})),u(n,r,e)},l="wff-cohort-14",s="https://nomoreparties.co/v1/".concat(l,"/users/me"),p="https://nomoreparties.co/v1/".concat(l,"/cards"),d={authorization:"6f573362-5f06-4f70-8bea-df09e2f16ca1","Content-Type":"application/json"};function f(){return fetch(p,{headers:d}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _,y,v=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup__input_type_name"),b=document.querySelector(".popup__input_type_description"),q=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=document.querySelector(".popup_type_image"),g=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption"),k=document.querySelector(".places__list"),x=h.querySelector(".popup__form"),j=v.querySelector(".popup__form"),A=document.querySelector(".popup_type_confirm"),T=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_avatar-edit"),w=P.querySelector('.popup__form[name="avatar-edit"]'),D=w.querySelector(".popup__input_type_avatar-link");function O(t){e(C),g.src=t.currentTarget.src,g.alt=t.currentTarget.alt,L.textContent=t.currentTarget.alt}function B(t){e(A),_=t}T.addEventListener("click",(function(){i(w,H),e(P)})),w.addEventListener("submit",(function(t){t.preventDefault();var e,r=D.value,o=w.querySelector(".popup__button"),c=o.textContent;o.textContent="Сохранение...",o.disabled=!0,(e=r,fetch("".concat(s,"/avatar"),{method:"PATCH",headers:d,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){document.querySelector(".profile__image").style.backgroundImage="url(".concat(t.avatar,")"),n(P),i(w,H)})).catch((function(t){return console.error("Error:",t)})).finally((function(){o.textContent=c,o.disabled=!1}))})),A.querySelector(".popup__form").addEventListener("submit",(function(e){var r;e.preventDefault(),(r=_,fetch("".concat(p,"/").concat(r),{method:"DELETE",headers:d}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(){k.innerHTML="",f().then((function(e){e.forEach((function(e){var n=t(e,y,O,B);k.appendChild(n)}))})).catch((function(t){return console.error("Error:",t)})),n(A)})).catch((function(t){return console.error("Error:",t)}))})),x.addEventListener("submit",(function(e){e.preventDefault();var r=x.querySelector(".popup__input_type_card-name").value,o=x.querySelector(".popup__input_type_url").value,c=x.querySelector(".popup__button"),u=c.textContent;c.textContent="Сохранение...",c.disabled=!0,function(t,e){return fetch(p,{method:"POST",headers:d,body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(r,o).then((function(e){var r=t(e,y,O,B);k.prepend(r),x.reset(),i(x,H),n(h)})).catch((function(t){return console.error("Error:",t)})).finally((function(){c.textContent=u,c.disabled=!1}))}));var I=document.querySelector(".profile__edit-button"),M=document.querySelector(".profile__add-button"),N=document.querySelectorAll(".popup__close");M.addEventListener("click",(function(){i(x,H),e(h)})),I.addEventListener("click",(function(){i(j,H),e(v),S.value=q.textContent,b.value=E.textContent})),document.addEventListener("click",(function(t){t.target.classList.contains("popup")&&n(t.target)})),N.forEach((function(t){t.addEventListener("click",(function(){n(t.closest(".popup"))}))})),j.addEventListener("submit",(function(t){t.preventDefault();var e=S.value,r=b.value,o=j.querySelector(".popup__button"),c=o.textContent;o.textContent="Сохранение...",o.disabled=!0,function(t,e){return fetch(s,{method:"PATCH",headers:d,body:JSON.stringify({name:t,about:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(e,r).then((function(t){q.textContent=t.name,E.textContent=t.about,n(v),i(j,H)})).catch((function(t){return console.error("Error:",t)})).finally((function(){o.textContent=c,o.disabled=!1}))}));var z,H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};z=H,Array.from(document.querySelectorAll(z.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);u(n,r,e),n.forEach((function(a){a.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?"name"!==e.name||/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(e.value)?c(t,e,n):o(t,e,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы.",n):e.validity.valueMissing?o(t,e,"Вы пропустили это поле.",n):e.validity.tooShort?o(t,e,"Минимальное количество символов: ".concat(e.minLength,". Длина текста сейчас: ").concat(e.value.length," символ."),n):e.validity.typeMismatch&&"url"===e.type?o(t,e,"Введите адрес сайта.",n):o(t,e,e.validationMessage,n)}(t,a,e),u(n,r,e)}))}))}(t,z)})),Promise.all([fetch(s,{headers:d}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),f()]).then((function(e){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(n,r)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],u=o[1];y=c._id,q.textContent=c.name,E.textContent=c.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(c.avatar,")"),u.forEach((function(e){var n=t(e,y,O,B);k.appendChild(n)}))})).catch((function(t){return console.error("Error:",t)}))})();